<div class="banner" *ngIf="(ui.banner$ | async) as banner">
  <span>{{ banner }}</span>
  <button type="button" class="banner__close" (click)="ui.clearBanner()">Cerrar</button>
</div>

<div class="layout" *ngIf="authService.isAuthenticated(); else onlyContent">
  <aside class="sidebar" [class.sidebar--collapsed]="sidebarCollapsed">
    <div class="sidebar__brand" [class.sidebar__brand--center]="sidebarCollapsed">
      <a routerLink="/menu" class="brand">Sonri<span>Salud</span></a>
    </div>
    <a *ngIf="!authService.isAdmin()" routerLink="/perfil" class="sidebar__avatar" title="Mi perfil">
      <span class="avatar-circle">{{ profileInitials }}</span>
      <span class="label" *ngIf="!sidebarCollapsed">Perfil</span>
    </a>
    <nav class="sidebar__nav">
      <a routerLink="/menu" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
        <span class="icon">IN</span>
        <span class="label" *ngIf="!sidebarCollapsed">Inicio</span>
      </a>
      <a *ngIf="authService.isPaciente() || authService.isAdmin()" routerLink="/pacientes" routerLinkActive="active">
        <span class="icon">PA</span>
        <span class="label" *ngIf="!sidebarCollapsed">Paciente</span>
      </a>
      <a *ngIf="authService.isOdontologo() || authService.isAdmin()" routerLink="/odontologos" routerLinkActive="active">
        <span class="icon">OD</span>
        <span class="label" *ngIf="!sidebarCollapsed">Odontologo</span>
      </a>
      <a *ngIf="authService.isOdontologo() || authService.isAdmin()" [routerLink]="['/odontologos']" fragment="filtros-agenda" routerLinkActive="active">
        <span class="icon">FL</span>
        <span class="label" *ngIf="!sidebarCollapsed">Filtros</span>
      </a>
      <a *ngIf="authService.isOdontologo() || authService.isAdmin()" [routerLink]="['/odontologos']" [queryParams]="{ tab: 'historial' }" routerLinkActive="active">
        <span class="icon">H</span>
        <span class="label" *ngIf="!sidebarCollapsed">Historial</span>
      </a>
      <a *ngIf="authService.isAdmin()" routerLink="/administrador" routerLinkActive="active">
        <span class="icon">AD</span>
        <span class="label" *ngIf="!sidebarCollapsed">Administrador</span>
      </a>
    </nav>
    <div class="sidebar__footer">
      <button class="btn btn--light" (click)="logout()" title="Cerrar sesion">
        <span class="icon">SL</span>
        <span class="label" *ngIf="!sidebarCollapsed">Salir</span>
      </button>
    </div>
  </aside>

  <main class="content">
    <header class="topbar">
      <button class="icon-btn" (click)="toggleSidebar()" title="Mostrar/ocultar menu">
        <span class="icon-lines">|||</span>
      </button>
      <h1 class="topbar__title">SonriSalud</h1>
      <a *ngIf="!authService.isAdmin()" routerLink="/perfil" class="profile-chip" title="Mi perfil">
        <span class="avatar">{{ profileInitials }}</span>
      </a>
    </header>
    <section class="page">
      <router-outlet />
    </section>
  </main>
</div>

<ng-template #onlyContent>
  <router-outlet />
</ng-template>

<div class="loading-overlay" *ngIf="ui.loading$ | async">
  <div class="loading-spinner"></div>
  <p>Cargando...</p>
</div>
